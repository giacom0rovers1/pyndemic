% Giacomo Roversi - Remote Sensing
%\documentclass[DIV=14, paper=a4, fontsize=10pt]{scrartcl}
\documentclass[DIV=12, BCOR=0pt]{scrartcl}  % A4 paper and 11pt font size {scrartcl}
\usepackage[utf8x]{inputenc}
\usepackage[english]{babel}
%\usepackage[default]{raleway}
\usepackage[default]{cantarell}
\usepackage[cm]{sfmath}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{hyperref}
\usepackage[round]{natbib}
\usepackage{tabu}
\usepackage{booktabs} % for \toprule \midrule \bottomrule
\usepackage{physics}
\usepackage{siunitx}
\usepackage{eurosym}
\usepackage{graphicx}

\usepackage{esdiff}
\usepackage{xfrac}

\definecolor{linkcolour}{rgb}{0,0.2,0.6}
\hypersetup{colorlinks,breaklinks,urlcolor=linkcolour,linkcolor=linkcolour}  


\begin{document}
%	
%	\begin{flushright}
%	% Author	
%	{\large Giacomo Roversi} \\ 
%	{\small \href{mailto:giacomo.roversi2@studio.unibo.it}{giacomo.roversi2@studio.unibo.it} }\\
%	\vskip0.2in
%  % Date
%  {\large November 12, 2020}
%	\end{flushright}
%
%	\begin{flushleft}
%	\vskip0.2in
%	% Title
%	{\huge \textbf{Numerical simulations of influenza-like epidemic processes over complex networks}} 
%	\vskip0.2in
%	% Subtitle
%	{\Large \color{gray}
%	Reti complesse A.A. 2017-2018  \\
%	Università di Bologna - Laurea Magistrale in Fisica del Sistema Terra}
%	\end{flushleft}



\begin{flushright}
	% Author	
	{\large Giacomo Roversi} \\ 
	{\small \href{mailto:giacomo.roversi2@studio.unibo.it}{giacomo.roversi2@studio.unibo.it} }\\
	\vskip0.15in
	% Date
	{\large November 16, 2020}
\end{flushright}

\begin{flushleft}
	% 
	{\Large \color{gray}
		Reti complesse A.A. 2017-2018 - Prof. Daniel Remondini  \\
		Università di Bologna - Laurea Magistrale in Fisica del Sistema Terra}


	\vskip0.2in
	% Title
	{\huge\textbf{Numerical simulations of influenza-like epidemic processes over complex networks}} 
	\vskip0.33in
	
\end{flushleft}
%	\section*{Abstract}
	
	\section*{Introduction}
	\label{sec:intro}
	This work is based on \citet{Pastor-Satorras} %  Pastor-Satorras et al. (2015) 
	and aims to analyse numerically a series of contagion scenarios, inspired to the current COVID-19 pandemic, over a complex network of the human interaction patterns. 
 	Theoretical fundamentals and deterministic predictions of the SIR and SEIR models are firstly presented. These predictions are then compared with discrete-time numerical simulations over complex networks, carried out in python exploiting the \textit{NetworkX} and \textit{NDlib} libraries. The networks are chosen to show different aspects of the contagion dynamics, going from a random network to a clustered-scale-free one in progressive steps of realism and resemblance to the real human interaction networks. 
 	Finally, some mitigation and immunization strategies are discussed.
  
  
  \section{Theoretical reference}
  
  Under some simple assumption, the spreading of a contagion phenomenon could be studied analytically ..
  
  
  \subsection{The SIR epidemic model}
  The SIR model divides the population into three compartments: susceptible ($S$), infected ($I$) and removed ($R$), the latter meaning either recovered and immune or deceased. Its basic implementation assumes no vital dynamics (closed population, no births or deaths in the $S$ compartment) and homogeneous mixing (completely random interactions). Under this assumptions the transitions between compartments are regulated by a set of deterministic differential equations following the mass-action law. 
    
  \begin{figure}[h!]
  	\centering
  	\includegraphics[width=0.7\linewidth]{../immagini/SIR_02.png}
  	\caption{ }
  	\label{fig:SIRoverall}
  \end{figure}

  Calling $s = \sfrac{S}{N}$, $i = \sfrac{I}{N}$ and $r = \sfrac{R}{N}$ the relative populations of the three compartments, the differential equations read:
  
  \begin{align}
  	\diff{s}{t} = - \beta s i \quad;  \qquad 	\diff{i}{t} = \beta s i - \mu i \quad; \qquad  \diff{r}{t} = \mu i
  	\label{eq:sir}
  \end{align}
  
  The conservation of the total population is always granted: %$\quad s + i + r = 1 \ \ ; \quad \sfrac{\mathrm{d}N}{\mathrm{d}t}= 0$. \\
  \begin{align}
  	s + i + r = 1 \quad ; \qquad \diff{N}{t}= 0
  	\label{eq:sir_sum}
  \end{align}
  The coefficients $\beta$ and $\mu$ are the transition rates of two Poisson processes, i.e. with independent exponentially distributed events. The ratio between them is the basic reproduction number $R_0$, which is the expected total number of secondary infections generated by one infected individual.   
  The average time during which an individual can spread the contagion is $\tau_{r} = \sfrac{1}{\mu}$. The infection rate $\beta$ could be seen as the probability of a contagion event in a single time interval. Thus $R_0$ is the product of the probability of one infected individual to infect one susceptible times the duration of the contagious condition.
  \begin{align}
			R_0 = \frac{\beta}{\mu} = \beta \cdot \tau_{r}
			\label{eq:R0}
  \end{align}
  


  % TODO spostare sotto
  



  \subsubsection{The initial growth}
  
  The condition for an epidemic to develop is that, given an initial small fraction of infected individuals, the time derivative of $i$ needs to be greater than zero:
  \begin{align}
  	\diff{i}{t} = \beta s i - \mu i > 0 
  	\label{sir_growthCond}
  \end{align}
  \begin{align} % \qquad \Rightarrow \quad 	
  	\frac{\beta s}{\mu} > 1  % \mathrm{This \ requires:}
  	\label{eq:sir_growthReq}
  \end{align}
  
  Thus, for a completely susceptible population ($s \approx 1$), the contagion is going to spread if $R_0$ is greater than one. In the initial phase, $s(t=0)$ could be approximated to constant $s_0$. % and the time before recovery to infinite ($\mu$ very small). 
  Under this assumption the evolution of the infected population $i(t)$ becomes purely exponential:
  \begin{align}
  	\diff{i}{t} \approx  (\beta s_0 - \mu) \cdot i 
  	\label{eq:sir_approxi}
  \end{align}
  \begin{align} % \qquad \Rightarrow \quad 	
  	i(t) \approx i(0) \cdot e^{K_0 t} 
  	\label{eq:sir_growthK0}
  \end{align}
  \begin{align} % \qquad  \mathrm{with} \qquad 
  	K_0 = (\beta s_0 - \mu)
  	\label{eq:sir_K0}
  \end{align}
	
	being $K_0$ the initial growth rate. The exponential description could also be made through %either the doubling time $T_{d}$, or 
	the basic reproduction number $R_0$ itself:
	% in which case it becomes: $\ i(t) \approx i(0) \cdot 2^{\sfrac{t}{T_{d}}}$, : $\ i(t) \approx i(0) \cdot R_0^{\sfrac{t}{\tau_s}}$.
%	\begin{align}
%		i(t) \approx i(0) \cdot 2^{\sfrac{t}{T_{d}}}
%		\label{eq:sir_growthTd}  %\quad ; \qquad 
%	\end{align}
	\begin{align}
		i(t) \approx i(0) \cdot R_0^{\sfrac{t}{\tau_s}}
		\label{eq:sir_growthR0}
	\end{align}
%	 where $\tau_s$ is the serial interval, i.e. the average time of a complete iteration of the infection process .
	
%	In the latter, t
The serial interval $\tau_s$ represents the average time elapsed during one complete iteration of the infection chain process (i.e. from a generation $A$ to the generation $B$ of secondary infections produced by $A$) and it is estimated from $R_0$ and $K_0$: 
	\begin{align}
		\tau_s = \frac{\ln(R_0)}{K_0}
		\label{eq:serial}
	\end{align}


  \subsubsection{The evolution of the epidemic}
  
  As the epidemic grows, the depletion of susceptible individuals is no longer negligible and the reduction of the number of available candidates slows down the contagion.
  The actual reproduction number follows the evolution of the susceptible population and represents the remaining strength of the contagion:
  \begin{align}
		R(t) = R_0 \cdot s(t) 
		\label{eq:Rt}
  \end{align}
  When the value of $R(t)$ reaches $1$, the number of simultaneously infected individuals is at its peak. From there on, it becomes exponentially smaller and eventually dies out.
  
  Combining Eq. \ref{eq:sir_growthK0} and Eq. \ref{eq:sir_growthR0}, $R(t)$ could also be estimated from the instantaneous growth rate $K(t)$:
  \begin{align}
  	K(t) =  \diff{\ln(i(t))}{t} %  \quad ; \qquad  
  	\label{eq:Kt}
  \end{align}
  \begin{align}
  	R_K(t) = e^{K(t) \cdot \tau_s}
  	\label{eq:Rkt}
  \end{align}

  
  \subsection{The SEIR epidemic model}
  The SEIR mode introduces the exposed (E) compartment, where individuals that have already been infected but are not yet contagious belong. The presence of this incubation phase makes it more suitable for modelling the spread of an influenza-like epidemic as the COVID-19 one. Calling the new compartment's relative population $e = \sfrac{E}{N}$, the differential equations of the model read:
  
  \begin{align}
  	\diff{s}{t} = - \beta s i \quad;  \qquad 	\diff{e}{t} = \beta s i - \gamma e \quad; \qquad \diff{i}{t} = \gamma e - \mu i \quad; \qquad \diff{r}{t} = \mu i
  	\label{eq:seir}
  \end{align}
   where $\gamma$ is the transition rate between exposed and infective compartments. The total population is again conserved: $ s + e + i + r = 1$. 
  
  The Eq. \ref{eq:sir_approxi} for the SIR model traduces in two joint equations for $e$ and $i$, which can be written in a vectorized form:
  \begin{align}
  	\diff{}{t}
  	\begin{pmatrix}
  			e \\
  			i
  	\end{pmatrix}
  	\approx 
  	\begin{pmatrix}
  		 - \gamma & \beta s_0\\
  		 \gamma & - \mu
  	\end{pmatrix}
  	\begin{pmatrix}
  		e \\
  		i
  	\end{pmatrix}
	  = K_0
	  \begin{pmatrix}
	  	e \\
	  	i
	  \end{pmatrix} %> 0
		\label{eq:seir_approxi}
	\end{align}

The initial growth coefficient $K_0$ for the SEIR model is the bigger eigenvalue of the evolution matrix applied to the $\big( \begin{smallmatrix} e \\	i \end{smallmatrix}\big)$ vector and it is obtained solving the equation: 

	\begin{align}
		\det 
		\begin{pmatrix}
			- \gamma - K_0 & \beta s_0\\
			\gamma & - \mu - K_0
		\end{pmatrix} = 0
	\label{eq:seir_K0}
	\end{align}
 
 Considering the total population which is currently positive to the infection ( $p = e + i$ ), its initial evolution again follows an exponential law identical to Eq. \ref{eq:sir_growthK0}.
%  \begin{align}
%  	\det( \mathbf{G} - \lambda \mathbf{I}) = 0 \\  % \quad ; \qquad  K = \lambda_{max} \\ 
%  	\lambda^2 + \lambda(\gamma + \mu) + (1 - R(t)) \gamma \mu = 0 
%  \end{align}
	
  \subsubsection{Model configuration}
  The input parameters are chosen... %ref bib covid
  
  The expected values of $R_0$, $K_0$ and $\tau_s$ are calculated with Eq. \ref{eq:R0}, Eq. \ref{eq:seir_K0} and Eq. \ref{eq:serial} respectively.
	% params aggiungere K^{SIR}_0, \tau^{SIR}_s  K^{SEIR}_0, \tau^{SEIR}_s
  \input{params.tex}

  
  
  \section{Numerical solutions}
	The SciPy library offers an ODE solver ...
%	The evolution shown in Fig. \ref{fig:SIRtot}, left panel, is obtained integrating the differential equations of the model with the \textit{SciPy} python library, starting from an initially infected population of $0.1 \%$ (10 individuals).
	
	% TODO dichiarare i parametri utilizzati (cfr. studi COVID19)

	SIR faster than SEIR, same shape of positives ($p$).
	
		 \begin{figure}[h!]
		\centering
		\includegraphics[width=0.49\linewidth]{../immagini/SIR_03.png}
		\includegraphics[width=0.49\linewidth]{../immagini/SEIR_03.png}
		\caption{Exponential growth in the initial phase of an epidemic. }
		\label{fig:BothExp}
	\end{figure}

	$N$ is fixed at 10.000 individuals
	($i \approx 0.1 \%$)
	The values of the transition rates are kept constant throughout the various simulations: $\beta = 0.22 \ d^{-1}$ and $\mu = 0.1 \ d^{-1}$, resulting in $R_0 = 2.2$. The unit $d$ indicates "days", the simulation time step is $1 \ d$.



	The initial growth rate $K_0$ could be estimated through the exponential fit of the positives curve $i(t)$ in the initial phase of the epidemic, as shown in Fig. \ref{fig:SIRexp}. The initial part is arbitrarily selected to end at $\sfrac{1}{6}$ of the curve's maximum (epidemic peak), or to include at least 5 readings. From the fit results a growth rate $K_0$ of $0.11 \ d^{-1}$, which corresponds to a doubling time $T_{d}$ of $6.07 \ d$. Given the reproduction number of $2.2$, the serial interval $\tau_s$ results $6.9 \ d$, that is smaller than the total duration of the illness $\tau_{r}$.

	\begin{figure}[h!]
		\centering
		%  	\includegraphics[width=0.7\linewidth]{../immagini/SIR_02.png}
		\includegraphics[width=0.49\linewidth]{../immagini/SEIR_02.png}
		\includegraphics[width=0.49\linewidth]{../immagini/SEIR_04.png}
		\caption{\textbf{Left}: Typical evolution of a SEIR model. \textbf{Right}: Instantaneous reproduction number }
		\label{fig:SIRtot}
	\end{figure}
	 
	The infectious peak is near $1900$ individuals simultaneously infected ($18.8 \%$ of the total population) and is reached on day 59. After $188 \ d$ the total population interested by the infection $r_{final}$ reaches $85 \%$ and the infected population $i_{final}$ is zero: the epidemic has ended. 
	
	  %To gauge the strength of the epidemic process, the reproduction number is followed through the evolution of the contagion. 
	In the right panel, blue line, the $R(t)$ predicted from Eq. \ref{eq:Rt} is shown. 
	The derivative is performed with second order accurate central differences, the resulting $R(t)$ estimate is plotted in gray. A rolling window mean is applied to filter out the noise if present (orange line). The two estimates of the reproduction number show some differences in the first and last plateau values, but are in perfect agreement about the slope value and the crossing time of the $R = 1$ line (red, dashed).
	
	
	SEIR:	
%	\begin{figure}[h]
%		\centering
%		\includegraphics[width=0.477\linewidth]{../immagini/SEIR_02.png}
%		\includegraphics[width=0.503\linewidth]{../immagini/SEIR_03.png}
%		\caption{}
%		\label{}
%	\end{figure}
	
	For the SEIR model, the exponential growth rate K controls the evolution of the number of total positives, defined as the sum of the exposed and the infected populations: $p(t) = e(t) + i(t)$. 
	
	% TODO initial population y0 = np.array([(1-frac_inf), frac_inf*(1-beta), frac_inf*beta, 0])
	
	$\gamma = 0.05 \ d^{-1}$ The growth is slower due to the delay added by the incubation period $\tau_{i}=\sfrac{1}{\gamma}$. The serial interval associated to the basic reproduction number is therefore bigger: $25 d$ instead of just $7 d$. Here $r_{final}$ and the peak intensity are practically the same as in the SIR model ($84 \% \ \mathrm{vs} \ 85 \%$ and $18.75 \% \ \mathrm{vs} \ 18.79 \% \ $ respectively), but the peak is reached 137 days later (on day 195), the end of the SEIR epidemic 337 days after the SIR has ended (on day 525). %This is the reference framework to which the following simulations are compared.
  
  
  
  \section{Complex networks}
  Translate: \textit{L'assunzione di omogeneita` e` sicuramente inadeguata per sistemi reali che presentano forte eterogeneita` di composizione e di rapporti relazionali. Si affronta la modellizzazione di questa eterogeneita` relazionale tramite reti complesse sulle quali riprodurre i modelli di contagio per step di interazione individuo-individuo discretizzati. In una rappresentazione discreta su network, i parametri del modello acquisiscono il valore di probabilita` di transizione (quindi su reti piccole si evidenzia l'effetto di fluttuazioni random, necessario approccio ensemble).  }
  
  Homogeneous mixing hypothesis is certainly inadequate for modelling real systems, which show heterogeneity of composition and relationship spanning various scales. 
  
  
  \input{networks.tex}
  
  Approach: recreate the same analysis work flow of the deterministic model
  Nodes = individuals, links = way of interaction (contagion)
  
  The deterministic prediction works as mean field approximation?
  
  Here $\beta$ is the contagion probability for a single interaction ($\xi$) times the average number of interactions which is given by the average connectivity degree $<k>$ of the network. The $<k>$ and $\xi$ parameters are chosen in such a way that $\beta$, hence $R_0$, is kept constant and equal to the deterministic infection rate. This is done to allow cross-network intercomparison. Given that the average connectivity is considered, for heterogeneous networks there could locally be major fluctuations from the average behaviour.
  
  
  Initial 10 infected nodes chosen at random (further work: ensemble)
  
  \subsection{Random network}
  Erdos Renyi
  Contagion on random network evolves similarly to the deterministic ODE problem. 
  
  Smoothing of the positives (Exposed + Infected) curve is needed to avoid contamination from numerical and most importantly network noise. 
  
  Network noise is strictly linked to the random nature of the network, locally there are deviations from the average connectivity which make the epidemic evolve ad different speeds
  
  
  \subsection{Lattice}
  Ring
  The contagion is strongly inhibited, starts exponentially slower than the rest, Rt(0) most similar to predicted R0,
  then stops (no, oscillates around R=1, still going) with plenty of susceptible nodes still available but not reachable. Try with more days.
  
  
  \subsection{Small-World}
  Watts Strogatz
  Starts similar to lattice, evolves similar to random. GOOD
  
  \subsection{Scale free}
  Barabasi-Albert
  Initial boost is the fastest, $K_0=0.006$ and Td is less than 12 days. Look at the degree structure..
  
  
  \subsection{Scale free with clustering}
  Holme-Kim
  The initial growth is almost exponential and $K_0$ is high but after that the pandemic slows down extremely fast
  
  
  
  \input{results.tex}
  
  
  \section{Immunization and mitigation strategies}
  \subsection{Lockdown and quarantine}
  \subsection{Vaccines}
  \subsubsection{Random (failure)}
	\subsubsection{Targeted (attack)}

	\section{Conclusions}

		
%  \small
  \footnotesize
	\bibliographystyle{plainnat} %  % apalike
	% Apalike non mostra i DOI, plainnat o abbrvnat mettono i nomi prima dei cognomi
	\bibliography{networks}

\end{document}



%%% Vademecum %%%
Bibliography:
\bibliographystyle{plainnat} %  % apalike
% Apalike non mostra i DOI, plainnat o abbrvnat mettono i nomi prima dei cognomi
\bibliography{networks}

Citations:
\citep{bibid}
\citet{bibid}

Math expressions:
\begin{align}
	a = b
\end{align}

Tables:
\begin{table}[h]
	\centering
	\begin{tabu} to \textwidth {X[1,l]X[1,c]X[1,c]X[1,c]} 
		\toprule
		Product & Reference  & Latency  & Spatial \\
		&time step (min)  &  (min)  &   resolution (km) \\ 
		\midrule
		CML & 15 &20 & 5 \\
		Radar raw & 5 & 15 & 1 \\
		Radar adj. & 60 & 60 &  1 \\
		Raingauges raw & 60 & 60 &  - \\
		ERG5 & 60 & 1440 & 5 \\ 
		\bottomrule
	\end{tabu}
	\caption{Latency and spatial and temporal sampling of the considered precipitation products.}
	\label{tab:latency}
\end{table}

Figures:
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.75\linewidth]{../Es01/immagini/dati4.png}
	\caption{Portate in funzione dei tiranti per le 4 campagne di misura, con incertezze al 25\%.}
	\label{fig:dati}
\end{figure}
