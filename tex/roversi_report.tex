% Giacomo Roversi - Remote Sensing
%\documentclass[DIV=14, paper=a4, fontsize=10pt]{scrartcl}
\documentclass[DIV=12, BCOR=0pt]{scrartcl}  % A4 paper and 11pt font size {scrartcl}
\usepackage[utf8x]{inputenc}
\usepackage[english]{babel}
%\usepackage[default]{raleway}
\usepackage[default]{cantarell}
\usepackage[cm]{sfmath}
\usepackage{amsmath}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{hyperref}
\usepackage[round]{natbib}
\usepackage{tabu}
\usepackage{booktabs} % for \toprule \midrule \bottomrule
\usepackage{physics}
\usepackage{siunitx}
\usepackage{eurosym}
\usepackage{graphicx}

\usepackage{esdiff}
\usepackage{xfrac}


\graphicspath{ {../immagini/} } % aggiornare una volta definitive % 08_beforeLastFixes/
\definecolor{linkcolour}{rgb}{0,0.2,0.6}
\hypersetup{colorlinks,breaklinks,urlcolor=linkcolour,linkcolor=linkcolour}  


\begin{document}
%	
%	\begin{flushright}
%	% Author	
%	{\large Giacomo Roversi} \\ 
%	{\small \href{mailto:giacomo.roversi2@studio.unibo.it}{giacomo.roversi2@studio.unibo.it} }\\
%	\vskip0.2in
%  % Date
%  {\large November 12, 2020}
%	\end{flushright}
%
%	\begin{flushleft}
%	\vskip0.2in
%	% Title
%	{\huge \textbf{Numerical simulations of influenza-like epidemic processes over complex networks}} 
%	\vskip0.2in
%	% Subtitle
%	{\Large \color{gray}
%	Reti complesse A.A. 2017-2018  \\
%	Università di Bologna - Laurea Magistrale in Fisica del Sistema Terra}
%	\end{flushleft}



\begin{flushright}
	% Author	
	{\large Giacomo Roversi} \\ 
	{\small \href{mailto:giacomo.roversi2@studio.unibo.it}{giacomo.roversi2@studio.unibo.it} }\\
	\vskip0.15in
	% Date
	{\large November 16, 2020}
\end{flushright}

\begin{flushleft}
	% 
	{\Large \color{gray}
		Reti complesse A.A. 2017-2018 - Prof. Daniel Remondini  \\
		Università di Bologna - Laurea Magistrale in Fisica del Sistema Terra}


	\vskip0.2in
	% Title
	{\huge\textbf{Numerical simulations of epidemic processes in complex networks}} 
	\vskip0.33in
	
\end{flushleft}
%	\section*{Abstract}
	
	\section*{Introduction}
	\label{sec:intro}
	This work studies and compares a series of idealized contagion scenarios, simulated over different unweighted undirected static random networks resembling human-to-human interactions. It is inspired by the current worldwide effort in containing the COVID-19 pandemic and follows mainly \citet{PastorSatorras} and \citep{Firth2020}.
	
 	In the first section I will present the fundamental differential equations and the deterministic numerical solutions of the SIR and SEIR models. I will then compare the deterministic predictions with the results of discrete-time simulations over various random networks. The networks share the same size and average connectivity, but differ in clustering and degree distribution, allowing a progression from simple models to more realistic and complex ones, to show different aspects of the contagion dynamics. The simulations are carried out in Python 3, exploiting the \textit{NetworkX} and \textit{NDlib} libraries, which are integrated in a specific framework crafted for the occasion. % \citep{pyndemic}. 
 	Finally, I will implement and discuss some mitigation strategies.
  
  \section{Epidemic models}
  \label{sec:theory}
	The mathematical modelling of epidemic spreading in a specific population generally assumes that the population could be divided into different classes or compartments depending on the stage of the disease.
	Stochastic reaction-diffusion processes control the transitions among these compartments. 
	The spreading of the contagion follows the mass-action law, i.e. the force of the infection is proportional to the fraction of infected individual in the population.
	
  The homogeneous mixing hypothesis assumes that individuals in a population are well mixed, indistinguishable, and interact with members of the other compartments completely at random.
  Under this assumption, likewise under a mean-field approximation from statistical physics, full information about the state of the epidemic is encoded in the relative populations of the different compartments and a deterministic approach with differential equations is possible. Two models, SIR and SEIR, which differ in the number of compartments, are presented below.
   
  \subsection{The SIR epidemic model}
  
  \begin{figure}[h]
  	\centering
  	\includegraphics[width=0.7\linewidth]{SIR_02.png}
  	\caption{The complete development of the SIR model starting with $0.1\%$ infected population.}
  	\label{fig:SIRtot}
  \end{figure}

  The SIR model divides the population into three compartments: susceptible ($S$), infected ($I$) and removed ($R$), the latter meaning either recovered (and immune), hospitalized, self quarantined, deceased or any other situation where the contagion chain develops no further. Its basic implementation assumes no demographic effects (closed population, no births or deaths in the $S$ compartment) and homogeneous mixing. Under this assumptions the transitions between compartments are regulated by a set of deterministic differential equations. % following the mass-action law.
  Calling $N$ the total population, the relative population fractions of the 3 compartments are:
  \begin{align}
			s = \frac{S}{N}  \quad;  \qquad 	 i = \frac{I}{N}  \quad;  \qquad 	 r = \frac{R}{N}
  \end{align}

  The fundamental differential equations of the SIR model read:
  \begin{align}
  	\diff{s}{t} = - \lambda s i \quad;  \qquad 	\diff{i}{t} = \lambda s i - \mu i \quad; \qquad  \diff{r}{t} = \mu i
  	\label{eq:sir}
  \end{align}

  The total population $N$ is conserved (it's a closed system with no births nor deaths):  
  \begin{align}
  	s + i + r = 1 \quad ; \qquad \diff{s}{t} + \diff{i}{t} + \diff{r}{t} = 0  \quad ; \qquad  \diff{N}{t}= 0
  	\label{eq:sir_sum}
  \end{align}

	The coefficients $\lambda$ and $\mu$ are the transition rates of two Poisson processes, i.e. with independent, exponentially distributed events. The ratio between them is called the basic reproduction number $R_0$, which is the expected total number of secondary infections generated by one infected individual, given a totally susceptible population ($s=1$). 
	
	The transition rate $\lambda$ is the product of the average probability of transmission during a single contact ($\beta$) and the average number of expected contacts per individual ($\bar{k}$).
  The average time during which an individual can spread the contagion is $\tau_{r} = \sfrac{1}{\mu}$, thus $R_0$ is also the product of the infection probability and the duration of the contagious state. 
  \begin{align}
			R_0 = \frac{\lambda}{\mu} \ \equiv \ \frac{\beta \bar{k}}{\mu} \ \equiv \ \beta \bar{k} \tau_{r}
			\label{eq:R0}
  \end{align}

  \subsubsection{The initial growth}
  The condition for an epidemic to develop is that, given an initial small fraction of infected individuals, their number increases in time, i.e. the time derivative of $i$ is greater than zero:
  \begin{align}
  	\diff{i}{t} = \lambda s i - \mu i \quad > \ 0 
  	\label{sir_growthCond}
  \end{align}
  \begin{align} % \qquad \Rightarrow \quad 	
  	\frac{\beta \bar{k} }{\mu} \cdot s \ > \ 1  % \mathrm{This \ requires:}
  	\label{eq:sir_growthReq}
  \end{align}
  
  Thus, for a completely susceptible population ($s \approx 1$), the contagion is going to spread if $R_0$ is greater than one. In the initial phase, $s( t \! = \! 0)$ could be approximated to the constant $s_0$.
  Under this assumption the evolution of the infected population $i(t)$ becomes purely exponential:
  \begin{align}
  	\diff*{i}{t}{t=0} \approx \quad (\lambda s_0 - \mu) \cdot i 
  	\label{eq:sir_approxi}
  \end{align}
  \begin{align} % \qquad \Rightarrow \quad 	
  	i(t) \ \approx \ i(0) \cdot e^{K_0 t} 
  	\label{eq:sir_growthK0}
  \end{align}
  
 where $K_0$ is the initial growth rate:
 \begin{align} % \qquad  \mathrm{with} \qquad 
 	K_0 = (\lambda s_0 - \mu)
 	\label{eq:sir_K0}
 \end{align}
 
 The exponential growth could also be described in terms of the doubling time (which is the constant time interval after which the population has doubled):
	\begin{align}
		T_{d} = \frac{\ln 2}{K_0}
		\label{eq:doubling} 
	\end{align}
	\begin{align}
		i(t) \ \approx \ i(0) \cdot 2^{\sfrac{t}{T_{d}}}
		\label{eq:sir_growthTd} 
	\end{align}

	Or it could rather be described with the basic reproduction number $R_0$ itself:
	\begin{align}
		i(t) \ \approx \ i(0) \cdot R_0^{\sfrac{t}{\tau_s}}
		\label{eq:sir_growthR0}
	\end{align}

	The serial interval $\tau_s$ is defined from \citet{Du2020} as the average time duration between a primary case-patient having symptom onset and a secondary case-patient having symptom onset following the infection received by the first one (i.e. the time between two generation of infected individuals) and it is here estimated from $R_0$ and $K_0$, since no real clinical data was analysed: 
	\begin{align}
		\tau_s = \frac{\ln(R_0)}{K_0}
		\label{eq:serial}
	\end{align}

	I will consider both the basic reproduction number and the serial interval as general parameters of the simulated infectious phenomenon and I will not change them through the epidemic. Real-life, pandemic-scale events are clearly more heterogeneous (different immune responses, symptoms, healthcare systems, pathogen strains after mutations, and so on) and those parameters should be estimated from statistical analyses on real clinical data.  

  \subsubsection{The evolution of the epidemic}
  As the epidemic grows, the depletion of susceptible individuals is no longer negligible and the reduction of the number of available candidates slows the contagion down.
  The effective reproduction number $R(t)$ follows the evolution of the susceptible population fraction $s(t)$ and represents the remaining strength of the contagion:
  \begin{align}
		R(t) = R_0 \cdot s(t) 
		\label{eq:Rt}
  \end{align}

  When the value of $R(t)$ reaches $1$, the number of simultaneously infected individuals $i(t)$ is at its peak. From there on, it becomes exponentially smaller as the force of the infection lowers with both $i$ and $s$ and eventually dies out: the epidemic has ended.
  
  The instantaneous growth rate $K(t)$ follows the curve of the positive population:
  \begin{align}
  	K(t) =  \diff{\ln(i(t))}{t}
  	\label{eq:Kt}
  \end{align}

	Knowing the instantaneous growth rate and having defined a constant serial interval $\tau_s$ from the initial phase, it is possible to obtain a direct estimate of the daily value of $R(t)$ combining Eq. \ref{eq:sir_growthK0} and Eq. \ref{eq:sir_growthR0}. This estimate will be independent from Eq. \ref{eq:Rt} and will follow the actual evolution of the spreading:

  \begin{align}
  	R_K(t) = e^{K(t) \cdot \tau_s}
  	\label{eq:RKt}
  \end{align}

	But, since they virtually measure the same quantity, $R(t)$ and $R_K(t)$ should be comparable. If they are not, the assumptions on which $R_0$ is based are called into question.
  % TODO quali sono?????
  
  \subsection{The SEIR epidemic model}
  The SEIR model adds the exposed (E) compartment to the picture. Compartment E includes individuals who have already been infected but are not yet contagious. The presence of the incubation phase makes this model more suitable for modelling the spread of an influenza-like disease like COVID-19. 
  
  Calling $e = \sfrac{E}{N}$ the new compartment's relative population, the differential equations of the model now read:
  
  \begin{align}
  	\diff{s}{t} = - \lambda s i \quad;  \qquad 	\diff{e}{t} = \lambda s i - \gamma e \quad; \qquad \diff{i}{t} = \gamma e - \mu i \quad; \qquad \diff{r}{t} = \mu i
  	\label{eq:seir}
  \end{align}

  where $\gamma$ is the poissonian transition rate between the exposed and the infective compartments. The total population is again conserved: $ s + e + i + r = 1$.
  
  While the SIR model was governed by one single differential equation fot $i(t)$ (Eq. \ref{eq:sir_approxi}), the SEIR one needs a system of two equations for $e(t)$ and $i$.
  The system can be written in the form of a matrix operator applied to a vector. Determining the temporal evolution of the model is here an eigenvalue problem. Specifically, the initial growth problem with the $s(0) = s_0$ approximation reads as follows: 
  
  \begin{align}
  	\diff{}{t}
  	\begin{pmatrix}
  			e \\
  			i
  	\end{pmatrix}_{t=0}
  	\approx \
  	\begin{pmatrix}
  		 - \gamma & \lambda s_0\\
  		 \gamma & - \mu
  	\end{pmatrix}
  	\begin{pmatrix}
  		e \\
  		i
  	\end{pmatrix}
	  \quad = \quad K_0 %^{SEIR}
	  \begin{pmatrix}
	  	e \\
	  	i
	  \end{pmatrix} %> 0
		\label{eq:seir_approxi}
	\end{align}

The initial growth coefficient $K_0$ for the SEIR model is the bigger eigenvalue of the operator and it is obtained solving the equation: 

	\begin{align}
		\det 
		\begin{pmatrix}
			- \gamma - K_0 & \beta \bar{k} s_0\\ % ^{SEIR}
			\gamma & - \mu - K_0  %^{SEIR}
		\end{pmatrix} = 0
	\label{eq:seir_K0}
	\end{align}
 
 The initial evolution of the total positive population $p(t)$ still follows an exponential law identical to Eq. \ref{eq:sir_growthK0}.
%  given by: % $p(t) = e(t) + i(t)$ 
 \begin{align}
		p(t) = \ e(t) + i(t) \ \approx \  p(0) \cdot e^{K_0 t}
 \end{align}

%  But due to the incubation delay that is added to the dynamics of the infection, the other parameters being equal, the initial growth will be slower than in the SIR model.
 
	\section{Numerical integration}
	\label{sec:numerical}
	
  \subsection{Model configuration}
	The SIR and SEIR model are initialized with the same input parameters (obviously except $\gamma$). Among the initial population of 10 000 people, there are initially 10 infected and already contagious individuals ($i(t \! = \! 0) = 0.1 \%$).
	
	Epidemiological studies have identified that, for the SARS-CoV-2 infection, the incubation period is approximately $4$ to $5$ days \citep{Gandhi2020}, specifically $4.2 d$ according to \citet{Sanche2020}. The same study shows that, before awareness of the COVID-19 danger, the time from symptom onset to hospitalization was $5.5$ days, whereas after reports of potential human-to-human transmission, the duration shortened significantly to $1.5 d$. We can assume similar time scales for the self-quarantine measures. Since patients may be infectious $1$ to $3$ days before symptom onset \citep{Gandhi2020}, the actual model parameters should be shifted of that interval, being the model not about symptoms but infections. 
	
  The model is therefore initialized with three days removal period (population in "awareness mode") and three days incubation period. 
  The respective transition rates are both equal to $0.33 d^{-1}$ as shown in Tab. \ref{tab:params}. 
  The "non-awareness mode" with a removal period of seven days is treated without numerical simulations in Section \ref{sec:immuni}, just to highlight the importance of the early hospitalization of patients. 
  \input{params.tex}
 
  % TODO verificare che fili dopo la modifica con beta k
  $\bar{k} = 12$ is chosen as a fair approximation of the average daily physical contacts which one individual probably experiences in real life, while the probability $\beta$ is fixed at $6.1 \%$. In this way, on average, the infection rate $\beta \bar{k}$ parameter is equal to $0.73 d^{-1}$ and the basic reproduction number $R_0$ is 2.2. The literature indicates values of $R_0$ between $2$ and $3.5$ for respiratory diseases transmitted over breath droplets like influenza, common cold or COVID-19 \citep{Hilton2020, Sanche2020, Firth2020}.
  
  The expected values of $K_0$, $T_d$ and $\tau_s$ are calculated directly with Eq. \ref{eq:seir_K0}, Eq. \ref{eq:doubling} and Eq. \ref{eq:serial} respectively and are presented in Tab. \ref{tab:props}. The SEIR initial doubling time is longer than the SIR one because of the delay added by the incubation phase, but both are very short. Given the reproduction number of $2.2$, the serial interval $\tau_s$ for the SEIR model results $4.91 \ d$ from Eq. \ref{eq:serial}. This value will be kept as reference serial interval for the rest of the work.
  
  Clinical studies of the early spreading of COVID-19 in the Wuhan region estimate a serial interval between $4$ days \citep{Du2020} and $6$ days \citep{Firth2020}, and a growth rate between $0.1 \ d^{-1}$ \citep{Du2020} and $0.3 \ d^{-1}$ \citep{Sanche2020}. The time and growth scales obtained here are therefore consistent.
  \input{props.tex}  
  
  \subsection{Numerical solutions}
	The time-continuous evolutions of both deterministic models are calculated integrating the differential equations with an ODE solver of the \textit{SciPy} python library (I uploaded all the code at \citet{pyndemic}). 	% TODO Inserire codice in appendice? Release GitHub?
	The complete evolution of the SIR model is shown in Fig. \ref{fig:SIRtot}. It displays all the features discussed analytically in Section \ref{sec:theory}. After a fast initial growth, the number of individuals which simultaneously have the disease reaches a peak of $1900$ ($18.8 \%$ of the total population) on day 18. After $60 \ d$ the total outbreak size $r_{final}$ has reached $85 \%$ and the infected population $i_{final}$ is zero.
	
	The SEIR model instead reaches the peak only on day 41 and the epidemic remains active until day 100. Nevertheless, the peak size and the total outbreak size remain the same. The incubation time has no effect on the magnitude of the epidemic, only on the time scales (at least at this analytical level). These informations are summarized in Tab. \ref{tab:models}. 
	\begin{figure}[h!]
		\centering
		\includegraphics[width=0.49\linewidth]{SIR_03.png}
		\includegraphics[width=0.49\linewidth]{SEIR_03.png}
		\caption{Exponential growth in the initial phase of an outbreak for SIR (\textbf{left}) and SEIR (\textbf{right}). }
		\label{fig:BothExp}
	\end{figure}

	The values of the initial growth rates $K_0^{Fit}$ and doubling times $T_d^{Fit}$ are also indicated there. These are not the ones from Tab. \ref{tab:props} predicted analytically, but are estimated by exponentially fitting the incidence time series limited to the initial phase of the outbreak \citep{Bauch2005}, as shown in Fig. \ref{fig:BothExp}.
	 
	The initial part is arbitrarily selected to terminate at $0.16$ of the curve's maximum (epidemic peak) or to include at least 5 readings (from day 0 to day 4). 
	$K_0^{Fit}$ results $0.38 \ d^{-1}$ for the SIR model and  $0.15 \ d^{-1}$ for the SEIR one, in good agreement with the expected values. I will always plot both exponential fits over the positives curve when analysing the initial phase of an outbreak (the predicted in red, the extrapolated in black). 
	\input{models.tex}
	
	The complete evolution of the relative populations of the four compartments of the SEIR model is pictured in Fig. \ref{fig:SEIRboth}, left panel. The delay between the exposed peak and the infected peak is clearly visible. Since the two transition rates $\gamma$ and $\mu$ are equal, the two curves are identical and just shifted in time (otherwise the smaller the rate out, the bigger the relative population).
	\begin{figure}[h!]
		\centering
		%  	\includegraphics[width=0.7\linewidth]{SIR_02.png}
		\includegraphics[width=0.49\linewidth]{SEIR_02.png}
		\includegraphics[width=0.49\linewidth]{SEIR_04.png}
		\caption{\textbf{Left}: Typical evolution of a SEIR model. \textbf{Right}: Instantaneous reproduction number }
		\label{fig:SEIRboth}
	\end{figure}

	In the right panel, the same evolution is described by means of the instantaneous reproduction number. The blue line represents the estimate obtained from Eq. \ref{eq:Rt}; the orange line shows instead the result of Eq. \ref{eq:RKt} involving the serial interval and the instantaneous growth rate.  The value of $\tau_s = 4.9 \ d$ is the one calculated analytically for the SEIR model (see Tab. \ref{tab:props}) and will be the same for all the following SEIR simulations.
	The value of $K(t)$ instead is calculated every time step from Eq. \ref{eq:Kt}, where the derivative is performed with second order accurate central differences. The $R = 1$ red dashed line is plotted for reference.

	The initialization of the SEIR model with $i(0) = 0.001$ means that the simulation starts without any incubation delay, thus the instantaneously estimated $R_K(t)$ overshoots the expected value $R(t)$ at the beginning of the simulation. After few days the two estimates are in perfect agreement: the decaying slope is the same and so is the day when $R = 1$ is reached. Later on some discrepancy arises, $R_K(t)$ halting at $0.5$ while $R(t)$ dives a little lower.
 
	%This is the reference framework to which the following simulations are compared.
  
  % Confronto tempi di ricovero/rimozione

  
  \section{Epidemic modelling on complex networks}
  \label{sec:network}
  Homogeneous mixing hypothesis is certainly inadequate when modelling real systems. Human social networks show in fact a structural heterogeneity spanning various scales. Implementing the SEIR model as a diffusion process over a complex network should give more insight in the dynamics characterizing the epidemic spreading in a real environment. Here I will adopt the simplest network representation of the social contacts, i.e. with the nodes representing the individuals and the edges (links) the interactions between them. All edges are here considered equally effective in transmitting the contagion (unweighted network) with probability $\beta$. All nodes share the same incubation and recovery Poisson rates $\gamma$ and $\mu$. 
  
  The epidemic model will be discrete both regarding time (at the $1 d$ scale) and number of cases (at the single individual scale). Edges will be bi-directional (undirected network) because there is no hierarchical or ordering process in influenza-like diseases spreading, apart from a node being already infected or not (but this is the model responsibility, not the network). The network is static in time, meaning that all contacts are supposed to be active for all the time at the daily scale and that neither births nor deaths are considered, as it was for the deterministic continuous models too. 

  In this representation, the same predictions of the deterministic models could be obtained substituting the average number of contacts $\bar{k}$ with the average node connectivity degree of the network $\langle k \rangle $. Dropping the homogeneous mixing hypothesis should implicate instead that $\bar{k}$ is substituted by each node's connectivity degree $k$. Nodes with different connectivity should therefore be treated differently by the model's equations. 
  
  \subsection{The DBMF approach} 
  Assuming that all the nodes with the same $k$ could be considered statistically equivalent and share the same probability $P(k'|k)$ to be connected to any node of degree $k'$, a possible solution is to re-write the set of deterministic differential equations (Eq. \ref{eq:seir}) for each degree class separately.
  In this way, the homogeneous hypothesis is moved from the total population to the single k classes (k-stratification): the actual topology of the network is not yet taken into account, but at least the degree distribution is. 
  
  The deterministic differential equations are stratified for each degree and the evolution of the overall compartments is given by the sum of all the k-specific compartments. The $i$ and $r$ equations remain identical at the $k$ level, since the incubation and removal processes evolve for each node independently from the other ones. The contagion process instead, since it is based on the encounter between two populations without any constraint on degree, needs a proper degree-mixing term $\Gamma_k$ to be added to the equations. It controls the $s_k \cdot i_k'$ product in the $s(t)$ and $e(t)$ equations and grants that each $k$ susceptible class encounters every $k'$ infected class with the $P(k'|k)$ probability:
  \begin{align}
  	\diff{s_{k}}{t} = - \beta k s_{k} \Gamma_{k} \quad;  \qquad 	\diff{e_{k}}{t} =  \gamma e_{k} \ - \ \beta k s_{k} \Gamma_{k} 
  	%  	\quad; \qquad \diff{i_{k}}{t} = \gamma e_{k} - \mu i_{k} \quad; \qquad \diff{r_{k}}{t} = \mu i_{k}
  	\label{eq:seir_dbmf}
  \end{align}
  \begin{align}
  	\Gamma_{k} = \sum_{k'} \ P(k'|k) \ i_{k'}  \ \frac{k' - 1}{k}
  	\label{eq:mixing}
  \end{align}
  
  The coefficient $\frac{k' - 1}{k}$ takes into account that, in a static network, when considering the ratio of susceptible nearest neighbours of a node, the node that brought there the infection is certainly not among the susceptible ones, so it has to be ignored when calculating the actual probability of finding one susceptible neighbour.
  
  The largest eigenvalue $\Lambda_M$ of the corrected connectivity matrix $\tilde{C}$ ... % _{kk'}
 
  \begin{align}
		\tilde{C}_{kk'} = k \ P(k'|k) \ \frac{k' - 1}{k'} + \epsilon
  \end{align}

	where $\epsilon$ is a very small value ($10^{-10}$) that does not change the matrix at the considered precision (one individual is $ \sfrac{1}{N} = 10^{-4} \ , \ 0.1 \%$) but completes the k-spectrum in cases of holes (specific values of k missing), facilitating the matrix operations (inversion, eigenvalue problem).

% TODO check se mantenere il paragrafo seguente
%	The intention is to recreate the same analysis work flow of the deterministic models and see if, and under which conditions, the deterministic prediction works as mean field approximation and where instead is overcome by new results. 
%	More advanced approaches based on open-source real data, like the one described in \citet{Firth2020}, exploit a variable weighted and directed network topology that follows the actual interactions of a group of people during the day on a short time scale, greatly increasing the complexity and computational load of the simulations.
  
  
 
  Semplification for uncorrelated networks with the first and second moments of the distribution
  
  for heterogeneous networks there could be major deviations from the predicted behaviour. 
 
 
  %% TODO inserire osservabili K0 e Lambda? riscrivere le equazioni con soglia critica?
%  This approach will be a closer reference for the actual numerical simulations, which instead follow the random paths of the Markov chain of the contagion regulated by Poissonian transition rates.
%  I wont integrate the exact solutions for the evolution of the compartment's relative densities, but I will use the estimate of the %final prevalence obtained by DBMF as reference.
  
  
  The DBMF approach allows to predict some observables: (epidemic threshold, K0)
  \begin{align}
  	content...% TODO prevalence
  \end{align}
	
	$K_0^{uncorr}$ derived by the moments of the degree distribution, they are to be compared to the $K_0^{SEIR}$ value.
	
	$K_0^{eigenv}$ derived from $\Lambda_M$ departs from the other in cases of assortative / disassortative networks (seems to overestimate the effect)
	
	Critical value for $\frac{beta \langle k \rangle}{\mu} \cdot s(t)$: when is reached the epidemic starts to slow down ($R(t)$ reaches one). The higher the critical value, the more inhibited the transmission by the network's structure itself, without changing $\beta$ and $\mu$.
	% collegare con discorso immunita' di gregge 1/R0
	
	
	\begin{table}[h]
		\centering
		\caption{Results of the numerical simulations on networks. The values represent daily medians from 100 simulations with random initial conditions and same parameters.}
		\label{tab:dbmfa}
		\begin{tabular}{lccc}
			\toprule
			Network model & $K_0^{uncorr}$ $(d^{-1})$ & $K_0^{eigenv}$ $(d^{-1})$ & Critical value \\
			\midrule 
			 Erdos-Renyi 			& 	 0.15 &   0.15 &  1.04  \\
			 Ring lattice 		&    0.14 &   0.14 &  1.09  \\
			 Watts-Strogatz 	&    0.14 &   0.14 &  1.08  \\
			 Barabasi-Albert 	&    0.31 &   2.22 &  0.40  \\
			 Holme-Kim 				&    0.33 &   2.08 &  0.29  \\
			\bottomrule
	  \end{tabular}
	\end{table}

  \subsection{Network models}
  Real-world networks show a small diameter (compared to the number of nodes) but also a high clustering coefficient (high number of 3 vertex cliques) and a connectivity degree distribution spanning several orders of magnitude.
  To move from the homogeneous mixing hypothesis to the similarity to the real world, I will use five different random complex networks models: a perfectly random Erdos-Renyi (ER) network, a ring lattice (RL), a small-world Watts-Strogatz network (WS), a Barabasi-Albert (BA) scale-free network and finally a derivation of BA with increased clustering developed by \citet{Holme} (HK). All the network models except HK are defined and referenced in \citet{PastorSatorras}. 
  Fig. \ref{fig:networks0} and Fig. \ref{fig:networks1} show a summary of the network's main features: a representation of the network layout (from a scale model with one hundredth nodes), the connectivity degree distribution ($P(k) vs k$) and the scatterplot of the betweenness centrality against the degree ($BC vs k$). All networks are connected. Main properties are also reported in Tab. \ref{tab:networks}.
  \input{networks.tex}

  The ER network (Fig. \ref{fig:networks0}, left panel) serves as a null-model for the homogeneous mixing hypothesis. The random long-range connections lead to a low average path length (or small diameter, or high traversability). The node connectivity degree is normally distributed around the mean value (Gaussian red fit). 
  Its more radical counterpart is the RL (Fig. \ref{fig:networks0}, right panel) which describes only small-range (local) interactions. The higher clustering dramatically increases the network diameter. All the node share the same $k$, $C$ and $BC$.
  
  WS (central panel) is introduced to combine the two pictures together: random "shortcuts" allow a high traversability also in presence of high clustering. All three of them are created through the same Watts-Strogatz algorithm but with different probabilities for the edge random rewiring: $1$ for ER, $0$ for RL and $0.1$ for WS.

    
  Up to here, the average connectivity degree $\langle k \rangle$ still defines a precise scale for all the network properties. BA instead (Fig. \ref{fig:networks1}, left) introduces a connectivity distribution which extends over multiple orders of magnitude (scale-free in the limit of a continuously incrementing size), following a negative power law. But BA lacks again in clustering. 
  There are many models that try to extend BA toward a higher clustering and realistic growing dynamics, HK is chosen among them because it provides tunable clustering (here set at the maximum possible value of $1$) and because it is already integrated in the NetworkX library. The presence of clustering in HK is obtained by adding an edge which forms a triangle after each step of preferential attachment of the BA algorithm \citep{Holme}.
  HK is presented in Fig. \ref{fig:networks1}, central panel. Writing the scale-free distribution as: $P(k) \approx k^{- \gamma}$, BA and HK have respectively $\gamma = 2.68$ and $\gamma = 2.70$.
  The right panel of Fig. \ref{fig:networks1} refers instead to a HK copy where the highest BC nodes have been removed and it is introduced in Sec. \ref{sec:immuni}.

     
  \clearpage
  \begin{figure}[h!]
  	\centering
  	\includegraphics[width=0.33\linewidth]{random_00.png}
  	\includegraphics[width=0.33\linewidth]{smallw_00.png}
  	\includegraphics[width=0.33\linewidth]{lattice_00.png}
  	
  	\includegraphics[width=0.33\linewidth]{random_01.png}
  	\includegraphics[width=0.33\linewidth]{smallw_01.png}
  	\includegraphics[width=0.33\linewidth]{lattice_01.png}
  	\caption{ }
  	\label{fig:networks0}
  \end{figure}  	
  
  \begin{figure}[h!]
  	\centering
  	\includegraphics[width=0.33\linewidth]{random_02.png}
  	\includegraphics[width=0.33\linewidth]{smallw_02.png}
  	\includegraphics[width=0.33\linewidth]{lattice_02.png}
  	
  	\includegraphics[width=0.33\linewidth]{random_03.png}
  	\includegraphics[width=0.33\linewidth]{smallw_03.png}
  	\includegraphics[width=0.33\linewidth]{lattice_03.png}
  	
  	\includegraphics[width=0.33\linewidth]{random_04.png}
  	\includegraphics[width=0.33\linewidth]{smallw_04.png}
  	\includegraphics[width=0.33\linewidth]{lattice_04.png}
  	
  	\caption{ }
  	\label{fig:outcomes0}
  \end{figure}
  
  \clearpage
  
  \begin{figure}[h!]
  	\centering
  	\includegraphics[width=0.33\linewidth]{scalefree_00.png}
  	\includegraphics[width=0.33\linewidth]{realw_00.png}
  	\includegraphics[width=0.33\linewidth]{lockHiBC_connected_00.png}
  	
  	\includegraphics[width=0.33\linewidth]{scalefree_01.png}
  	\includegraphics[width=0.33\linewidth]{realw_01.png}
  	\includegraphics[width=0.33\linewidth]{lockHiBC_connected_01.png}
  	\caption{ }
  	\label{fig:networks1}
  \end{figure}  	
  
  \begin{figure}[h!]
  	\centering
  	\includegraphics[width=0.33\linewidth]{scalefree_02.png}
  	\includegraphics[width=0.33\linewidth]{realw_02.png}
  	\includegraphics[width=0.33\linewidth]{lockHiBC_connected_02.png}
  	
  	\includegraphics[width=0.33\linewidth]{scalefree_03.png}
  	\includegraphics[width=0.33\linewidth]{realw_03.png}
  	\includegraphics[width=0.33\linewidth]{lockHiBC_connected_03.png}
  	
  	\includegraphics[width=0.33\linewidth]{scalefree_04.png}
  	\includegraphics[width=0.33\linewidth]{realw_04.png}
  	\includegraphics[width=0.33\linewidth]{lockHiBC_connected_04.png}
  	
  	\caption{ }
  	\label{fig:outcomes1}
  \end{figure}
  
  \subsection{Simulations over networks}
  Simulations are run in batches of $100$ per network type to create an ensemble of random initial statuses and random infection patterns, while the network structures are fixed (keeping the seed in the generating functions fixed). The evolutions of the population compartments are presented in the top row of Fig. \ref{fig:outcomes0} and \ref{fig:outcomes1}, following the same column arrangement of Fig. \ref{fig:networks0} and Fig. \ref{fig:networks1}. In the middle row a zoom on the initial phase is shown (the axes are rescaled consequently). The evolution of the effective reproduction number is represented in the bottom row. The day by day medians of the considered variables (relative population of the compartments, instantaneous growth rate, Rt) are extracted from the ensembles and reported in Tab. \ref{tab:results}. The total spread within the ensembles is shown only graphically in the plots (colored areas).
  \input{results.tex}
  
  \subsubsection{Discussion}
  Contagion on random network evolves similarly to the deterministic ODE problem. 
  
  The coloured areas of ... Network noise is strictly linked to the random nature of the network, locally there are deviations from the average connectivity which make the epidemic evolve ad different speeds
  
  The initial growth is slower and the peak of positives (exposed + infected) is $26 \%$ smaller.
  
  DBMF growth rate
  
  % dire meglio (satorras Eq. 51)
  
  %This comes from a newly introduced dynamic: the system has memory, the constant mixing implied in the deterministic model happens not completely. Therefore if some infected node's contacts are already ill, the number of available susceptible neighbouring nodes may locally decrease much more than what is caught by the $s(t)$ global variable. This phenomenon becomes more and more dominant as clustering increases. 
  % questo e` un fenomeno di discostamento LOCALE dal comportamento complessivo, altrimenti e` gia` compreso nel fatto che la densita` di suscettibili cala. Basta dire questo, non tirare in ballo la memoria del sistema
  
  This effect can be included in the DBMF equations 
  resulting in a corrected connectivity matrix
  
  
  The observed spread of the $R(t)$ estimate is substantial at the beginning of the outbreak, since the ...
  The spread drops in the phase of major change in the speed of the contagion % occhio! piu` facile che sia una questione di pop relative? sembra che spread sia inv prop a pos size
  It grows again near the end, probably also due to numerical noise from the ratios between the small numbers of the last cases and the increased relative weight of random fluctuations.
  
  
  % (it will be briefly discussed in the next Section how with small N the hypothesis is still valid in the initial condition but is locally dropped as the epidemic evolves with memory in a static network)
  In the RL the phenomenon is much more dominant: the contagion is strongly inhibited by the fast depletion of nearby susceptible nodes % ripetizione?
  
  Clustering nevertheless gives an initial boost to the outbreak speed at the local scale (early peak day and high growth rate)
     
    %, starts exponentially slower than the rest, Rt(0) most similar to predicted R0,
  %then stops (no, oscillates around R=1, still going) with plenty of susceptible nodes still available but not reachable. Try with more days.
  
  %Outbreak size, peak, clustering... (figure, note su carta)
  
  Clustering sustains the spreading much longer
  
  Clustering limits the outbreak size \citep{PastorSatorras}
  true for the lattice ring and from WS, not so evident when coupled with scale-freeness (figure) \textbf{	Correlated (disassortative) vs uncorrelated}
  
  % Null models from Haslemerecontact tracing paper
  
	\begin{figure}[h!]
		\centering
		%  	\includegraphics[width=0.7\linewidth]{SIR_02.png}
		\includegraphics[width=0.49\linewidth]{analysis_Peak.png}
		\includegraphics[width=0.49\linewidth]{analysis_Size.png}
		\caption{\textbf{Left}: Peak size against peak day.
						 \textbf{Right}: Outbreak size against average node clustering coefficient. Ring lattice is omitted here.}
		\label{fig:analysis}
	\end{figure}

 
  
  
  
  \section{Mitigation strategies} %Immunization and 
  \label{sec:immuni}
  % from Haslemere contact tracing paper
  
  
   
   \subsection{Early hospitalization}
   which results in an $R_0$ greater than 5 for the "non-awareness mode" in the initial phase of the outbreak. These numbers are
%   It was already evident in Section \ref{sec:numerical} how much the delay between symptoms recognition and isolation measurements affects the overall strength of the epidemic.
   \citep{Firth2020} 
  
  \subsection{Vaccines}
  R0 and final outbreak size
  
  Network breakdown:
  \subsubsection{Random (failure)}
	\subsubsection{Targeted (attack)}

	\subsection{Lockdown and quarantine}
	High BC removal scenario, still damage done even with drastic action
	
	\begin{table}[h!]
		\centering
		\caption{Networks properties. $\langle k \rangle$ and $\langle C \rangle$ are the average node connectivity degree and the average clustering coefficient respectively. }
		\label{tab:lock_networks}
		\begin{tabular}{lccccc}
			\toprule
			Network &  Edges &  Nodes & $\langle k \rangle$ & $\langle C \rangle$ & $\langle l \rangle$\\
			\midrule
			Holme-Kim 		&  59963 &  10000 & 11.99 &  0.38 &  3.98 \\
			BC Truncated 	&  33717 &   9363 &  7.20 &  0.28 &  7.36 \\
			
			\bottomrule
		\end{tabular}
	\end{table}

Lockdown DBMF:
Kseir: [0.08 0.08 0.29]
Critical value: [1.43 1.45]


	\begin{table}[h!]
		\centering
		\caption{Summary of the numerical simulations over networks. The indicated values represent the median from 100 simulations.}
		\label{tab:lock_results}
		\begin{tabular}{lcccccccc}
			\toprule
			%   Model & $K_0^{Fit}$ $(d^{-1})$ & $T_d^{Fit}$ $(d)$ & $i_{end}$ & $r_{end}$ & End day $(\#)$ & Peak $(\%)$ & Peak day $(\#)$ \\
			Network model & $K_0^{Fit}$ $(d^{-1})$ & $T_d^{Fit}$ $(d)$ & $i_{end}$ & $r_{end}$ & End day & Peak  & Peak day & $s_{peak}$\\
			\midrule
		 	Holme-Kim 		&    0.33 &   2.08 &  0.00 &  0.71 &  	 87 &  0.17 &   25 &	0.63\\
			BC Truncated	&    0.27 &   2.53 &  0.00 &  0.37 & 		125 &  0.06 &   22 &	0.79\\
			
			
			\bottomrule
		\end{tabular}
	\end{table}
	
%	Provare self isolation? (tagliare dal basso la BC?)
	
	\section{Conclusions}
%
%	\section*{Appendix}
%		
%  \small
  \footnotesize
	\bibliographystyle{plainnat} %  % apalike
	% Apalike non mostra i DOI, plainnat o abbrvnat mettono i nomi prima dei cognomi
	\bibliography{networks}

\end{document}



%%% Vademecum %%%
Bibliography:
\bibliographystyle{plainnat} %  % apalike
% Apalike non mostra i DOI, plainnat o abbrvnat mettono i nomi prima dei cognomi
\bibliography{networks}

Citations:
\citep{bibid}
\citet{bibid}

Math expressions:
\begin{align}
	a = b
\end{align}

Tables:
\begin{table}[h]
	\centering
	\begin{tabu} to \textwidth {X[1,l]X[1,c]X[1,c]X[1,c]} 
		\toprule
		Product & Reference  & Latency  & Spatial \\
		&time step (min)  &  (min)  &   resolution (km) \\ 
		\midrule
		CML & 15 &20 & 5 \\
		Radar raw & 5 & 15 & 1 \\
		Radar adj. & 60 & 60 &  1 \\
		Raingauges raw & 60 & 60 &  - \\
		ERG5 & 60 & 1440 & 5 \\ 
		\bottomrule
	\end{tabu}
	\caption{Latency and spatial and temporal sampling of the considered precipitation products.}
	\label{tab:latency}
\end{table}

Figures:
\begin{figure}[!htb]
	\centering
	\includegraphics[width=0.75\linewidth]{../Es01/immagini/dati4.png}
	\caption{Portate in funzione dei tiranti per le 4 campagne di misura, con incertezze al 25\%.}
	\label{fig:dati}
\end{figure}
